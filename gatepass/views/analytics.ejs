<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hostel Analytics Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* General Styling */
        body { background-color: #f4f6f9; font-family: 'Segoe UI', sans-serif; }
        
        /* Navbar Customization */
        .navbar-custom { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            padding: 1.2rem 1rem; /* Increased top/bottom padding for navbar */
        }
        
        /* Card Styling for Better Visual Hierarchy */
        .card-stat { 
            border: none; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            transition: transform 0.2s; 
            padding: 1.5rem; /* Increased internal padding */
        }
        .card-stat:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        /* Text/Value Styling */
        .stat-title { font-size: 0.85rem; color: #666; font-weight: 700; text-transform: uppercase; }
        .stat-value { font-size: 2.0rem; font-weight: 800; color: #333; }
        
        /* Background Colors */
        .bg-success-light { background-color: #d4edda; color: #155724; }
        .bg-danger-light { background-color: #f8d7da; color: #721c24; }
        .bg-info-light { background-color: #cfe2ff; color: #084298; }
        
        /* Header and Chart Containers */
        .chart-container {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
    </style>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>

    <nav class="navbar navbar-dark navbar-custom">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1 ps-3"><i class="fas fa-chart-line me-2"></i>Hostel Analytics</span>
            <a href="/attendance" class="btn btn-outline-light btn-sm me-3"><i class="fas fa-calendar-check me-1"></i>Attendance Grid</a>
        </div>
    </nav>

    <div class="container mt-5 pb-5"> <h3 class="mb-5 fw-bold text-dark">Today's Hostel Overview</h3>

        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="card card-stat" style="border-left: 6px solid #6c5ce7;">
                    <div class="stat-title">Total Students (Hostel)</div>
                    <h3 class="fw-bold mb-0 stat-value"><%= stats.attendance.Total || 0 %></h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stat bg-success-light" style="border-left: 6px solid #28a745;">
                    <div class="stat-title text-success">Present (In)</div>
                    <h3 class="fw-bold mb-0 stat-value"><%= stats.attendance.Present || 0 %></h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stat bg-danger-light" style="border-left: 6px solid #dc3545;">
                    <div class="stat-title text-danger">Absent (Out)</div>
                    <h3 class="fw-bold mb-0 stat-value"><%= stats.attendance.Absent || 0 %></h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stat bg-info-light" style="border-left: 6px solid #007bff;">
                    <div class="stat-title text-primary">Home Pass</div>
                    <h3 class="fw-bold mb-0 stat-value"><%= stats.attendance.Home || 0 %></h3>
                </div>
            </div>
        </div>

        <div class="row g-5"> <div class="col-md-6">
                <div class="card card-stat h-100 chart-container">
                    <div class="card-header bg-white fw-bold py-3"><i class="fas fa-utensils me-2"></i>Mess Preference</div>
                    <div class="card-body p-0">
                        <div id="mess_chart" style="width: 100%; height: 350px;"></div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card card-stat h-100 chart-container">
                    <div class="card-header bg-white fw-bold py-3"><i class="fas fa-building me-2"></i>Total Students by Block</div>
                    <div class="card-body p-0">
                        <div id="block_chart" style="width: 100%; height: 350px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-12">
                <div class="card card-stat h-100 chart-container">
                    <div class="card-header bg-white fw-bold py-3"><i class="fas fa-graduation-cap me-2"></i>Student Breakdown by Year</div>
                    <div class="card-body p-0">
                        <div id="year_chart" style="width: 100%; height: 400px;"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart', 'bar']});
        google.charts.setOnLoadCallback(drawCharts);

        function drawCharts() {
            // --- 1. MESS CHART ---
            var messData = new google.visualization.DataTable();
            messData.addColumn('string', 'Type');
            messData.addColumn('number', 'Count');
            
            <% stats.mess.forEach(function(item) { %>
                messData.addRow(['<%= item.mess_type %>', <%= item.count %>]);
            <% }); %>

            var messOptions = { 
                title: 'Veg vs Non-Veg Count', 
                pieHole: 0.4, 
                colors: ['#28a745', '#dc3545'], 
                legend: { position: 'bottom' },
                chartArea: { width: '90%', height: '80%' }
            };
            var messChart = new google.visualization.PieChart(document.getElementById('mess_chart'));
            messChart.draw(messData, messOptions);

            // --- 2. BLOCK CHART ---
            var blockData = new google.visualization.DataTable();
            blockData.addColumn('string', 'Block');
            blockData.addColumn('number', 'Students');

            <% stats.block.forEach(function(item) { %>
                blockData.addRow(['Block <%= item.block %>', <%= item.count %>]);
            <% }); %>

            var blockOptions = { 
                title: 'Student Count by Hostel Block', 
                colors: ['#007bff', '#17a2b8'], 
                legend: { position: 'bottom' },
                chartArea: { width: '90%', height: '80%' }
            };
            var blockChart = new google.visualization.PieChart(document.getElementById('block_chart'));
            blockChart.draw(blockData, blockOptions);

            // --- 3. YEAR BREAKDOWN CHART ---
            var yearData = new google.visualization.DataTable();
            yearData.addColumn('string', 'Year');
            yearData.addColumn('number', 'Students');

            <% stats.year.forEach(function(item) { %>
                yearData.addRow(['<%= item.year %>', <%= item.count %>]);
            <% }); %>

            var yearOptions = {
                title: 'Student Count by Academic Year',
                bars: 'vertical',
                hAxis: { title: 'Academic Year' },
                vAxis: { title: 'Number of Students' },
                legend: { position: 'none' },
                colors: ['#6c5ce7'],
                chartArea: { width: '95%', height: '75%' }
            };
            var yearChart = new google.visualization.ColumnChart(document.getElementById('year_chart'));
            yearChart.draw(yearData, yearOptions);
        }
    </script>
</body>
</html>