<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Student Portal</title>
    <link rel="stylesheet" href="../stylesheets/studentportal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/images/4174.png">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <button class="sidebar-close" onclick="toggleSidebar()">
            <i class="fas fa-times"></i>
        </button>
        <div class="logo">
            <img src="/images/4174.png" alt="Logo">
            <h2>Gate Pass</h2>
        </div>
        
        <ul class="nav-links">
            <li>
                <a href="/student/dashboard" class="active">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="/student/profile">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </a>
            </li>
            <li>
                <a href="/student/attendance">
                    <i class="fas fa-calendar-check"></i>
                    <span>Attendance</span>
                </a>
            </li>
            <li>
                <a href="/student/passhistory">
                    <i class="fas fa-history"></i>
                    <span>Pass History</span>
                </a>
            </li>
            <li>
                <a href="/student/requestpass">
                    <i class="fas fa-ticket-alt"></i>
                    <span>Request Pass</span>
                </a>
            </li>
            <li>
                <a href="/student/notifications">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </a>
            </li>
        </ul>
        
        <div class="user-info">
            <div class="user-detail">
                <img src="<%= student.path || '/images/default-avatar.png' %>" alt="Profile">
                <div>
                    <div class="name"><%= student.sname %></div>
                    <div class="role"><%= student.uid %></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="topbar">
            <div class="page-title">
                <h1>Welcome, <%= student.sname.split(' ')[0] %>!</h1>
                <p><%= new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></p>
            </div>
            
            <div class="user-actions">
                <a href="/student/notifications" class="notification-btn">
                    <i class="fas fa-bell"></i>
                </a>
                <a href="/student/logout" class="logout-btn" style="text-decoration: none;">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </div>
        </div>
        
        <% if(message && message.length > 0){ %>
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <%- message %>
            </div>
        <% } %>
        
        <!-- Status Cards -->
        <div class="dashboard-cards">
            <div class="card">
                <div class="card-header">
                    <h3>Current Status</h3>
                    <div class="icon <%= student.status === 'Restrict' ? 'red' : 'green' %>">
                        <i class="fas <%= student.status === 'Restrict' ? 'fa-ban' : 'fa-check-circle' %>"></i>
                    </div>
                </div>
                <div class="card-value">
                    <span class="status-badge <%= student.status === 'Restrict' ? 'restricted' : 'active' %>">
                        <%= student.status === 'Restrict' ? 'Restricted' : 'Active' %>
                    </span>
                </div>
                <div class="card-label">Account Status</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>Total Passes</h3>
                    <div class="icon blue">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                </div>
                <div class="card-value"><%= stats.totalPasses || 0 %></div>
                <div class="card-label">All time passes</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>This Month</h3>
                    <div class="icon purple">
                        <i class="fas fa-calendar"></i>
                    </div>
                </div>
                <div class="card-value"><%= stats.monthPasses || 0 %></div>
                <div class="card-label">Passes this month</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>Active Pass</h3>
                    <div class="icon <%= activePass ? 'orange' : 'green' %>">
                        <i class="fas <%= activePass ? 'fa-door-open' : 'fa-door-closed' %>"></i>
                    </div>
                </div>
                <div class="card-value">
                    <span class="status-badge <%= activePass ? 'pending' : 'active' %>">
                        <%= activePass ? 'OUT' : 'IN' %>
                    </span>
                </div>
                <div class="card-label"><%= activePass ? activePass.passtype : 'Inside Campus' %></div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="/student/requestpass" class="quick-action-btn">
                <i class="fas fa-plus-circle"></i>
                <span>Request Pass</span>
            </a>
            <a href="/student/attendance" class="quick-action-btn">
                <i class="fas fa-calendar-alt"></i>
                <span>View Attendance</span>
            </a>
            <a href="/student/passhistory" class="quick-action-btn">
                <i class="fas fa-history"></i>
                <span>Pass History</span>
            </a>
            <a href="/student/profile" class="quick-action-btn">
                <i class="fas fa-user-edit"></i>
                <span>Edit Profile</span>
            </a>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- Active Pass Card -->
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-id-card"></i> Current Pass Status</h2>
                </div>
                
                <% if(activePass) { %>
                    <div class="pass-card">
                        <div class="pass-type"><%= activePass.passtype %></div>
                        <div class="pass-status">
                            <i class="fas fa-door-open"></i> Currently Outside
                        </div>
                        <div class="pass-details">
                            <div class="pass-detail-item">
                                <label>Approved On</label>
                                <span><%= activePass.approvaldt || 'N/A' %></span>
                            </div>
                            <div class="pass-detail-item">
                                <label>Gate Out Time</label>
                                <span><%= activePass.outdatetime || 'Not yet' %></span>
                            </div>
                            <div class="pass-detail-item">
                                <label>Approved By</label>
                                <span><%= activePass.hosteloutauth || 'N/A' %></span>
                            </div>
                            <div class="pass-detail-item">
                                <label>Status</label>
                                <span><%= activePass.status %></span>
                            </div>
                        </div>
                    </div>
                <% } else { %>
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>No Active Pass</h3>
                        <p>You are currently inside the campus</p>
                    </div>
                <% } %>
            </div>
            
            <!-- Recent Activity -->
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-clock"></i> Recent Activity</h2>
                    <a href="/student/passhistory" class="btn btn-primary">View All</a>
                </div>
                
                <% if(recentLogs && recentLogs.length > 0) { %>
                    <div class="timeline">
                        <% recentLogs.slice(0, 5).forEach(function(log) { %>
                            <div class="timeline-item">
                                <div class="time"><%= log.approvaldt || log.outdatetime || log.indatetime %></div>
                                <div class="content">
                                    <h4><%= log.passtype || 'Entry/Exit' %></h4>
                                    <p>
                                        <% if(log.outdatetime && !log.indatetime) { %>
                                            Gate Out: <%= log.outdatetime %>
                                        <% } else if(log.indatetime) { %>
                                            Gate In: <%= log.indatetime %>
                                        <% } else { %>
                                            Pass Generated
                                        <% } %>
                                    </p>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>No Recent Activity</h3>
                        <p>Your activity will appear here</p>
                    </div>
                <% } %>
            </div>
        </div>
        
        <!-- Profile Summary -->
        <div class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-user"></i> Profile Summary</h2>
                <a href="/student/profile" class="btn btn-primary">View Full Profile</a>
            </div>
            
            <div class="profile-grid">
                <div class="profile-item">
                    <div class="icon"><i class="fas fa-id-badge"></i></div>
                    <div class="details">
                        <label>Student UID</label>
                        <span><%= student.uid %></span>
                    </div>
                </div>
                <div class="profile-item">
                    <div class="icon"><i class="fas fa-graduation-cap"></i></div>
                    <div class="details">
                        <label>Department</label>
                        <span><%= student.dept || 'N/A' %></span>
                    </div>
                </div>
                <div class="profile-item">
                    <div class="icon"><i class="fas fa-layer-group"></i></div>
                    <div class="details">
                        <label>Year</label>
                        <span><%= student.year || 'N/A' %></span>
                    </div>
                </div>
                <div class="profile-item">
                    <div class="icon"><i class="fas fa-building"></i></div>
                    <div class="details">
                        <label>Category</label>
                        <span><%= student.category || 'N/A' %></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
            document.querySelector('.sidebar-overlay').classList.toggle('active');
            document.body.style.overflow = document.querySelector('.sidebar').classList.contains('active') ? 'hidden' : '';
        }
    </script>
</body>
</html>