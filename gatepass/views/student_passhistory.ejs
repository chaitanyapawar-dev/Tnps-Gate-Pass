<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pass History - Student Portal</title>
    <link rel="stylesheet" href="/stylesheets/studentportal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/images/4174.png">

    <style>

        a{

            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <button class="sidebar-close" onclick="toggleSidebar()">
            <i class="fas fa-times"></i>
        </button>
        <div class="logo">
            <img src="/images/4174.png" alt="Logo">
            <h2>Gate Pass</h2>
        </div>
        
        <ul class="nav-links">
            <li>
                <a href="/student/dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="/student/profile">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </a>
            </li>
            <li>
                <a href="/student/attendance">
                    <i class="fas fa-calendar-check"></i>
                    <span>Attendance</span>
                </a>
            </li>
            <li>
                <a href="/student/passhistory" class="active">
                    <i class="fas fa-history"></i>
                    <span>Pass History</span>
                </a>
            </li>
            <li>
                <a href="/student/requestpass" style="text-decoration: none;">
                    <i class="fas fa-ticket-alt"></i>
                    <span >Request Pass</span>
                </a>
            </li>
            <li>
                <a href="/student/notifications">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </a>
            </li>
        </ul>
        
        <div class="user-info">
            <div class="user-detail">
                <img src="<%= student.path || '/images/default-avatar.png' %>" alt="Profile">
                <div>
                    <div class="name"><%= student.sname %></div>
                    <div class="role"><%= student.uid %></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="topbar">
            <div class="page-title">
                <h1>Pass History</h1>
                <p>View all your gate pass records</p>
            </div>
            
            <div class="user-actions">
                <a href="/student/requestpass" class="notification-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; text-decoration: none;">
                    <i class="fas fa-plus"></i> Request Pass
                </a>
                <a href="/student/logout" class="logout-btn" style="text-decoration: none;">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </div>
        </div>
        
        <!-- Statistics Cards -->
        <div class="dashboard-cards">
            <div class="card">
                <div class="card-header">
                    <h3>Total Passes</h3>
                    <div class="icon blue">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                </div>
                <div class="card-value"><%= stats.totalPasses || 0 %></div>
                <div class="card-label">All time passes</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>City Passes</h3>
                    <div class="icon orange">
                        <i class="fas fa-city"></i>
                    </div>
                </div>
                <div class="card-value"><%= stats.cityPasses || 0 %></div>
                <div class="card-label">Total city passes</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>Home Passes</h3>
                    <div class="icon green">
                        <i class="fas fa-home"></i>
                    </div>
                </div>
                <div class="card-value"><%= stats.homePasses || 0 %></div>
                <div class="card-label">Total home passes</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>This Month</h3>
                    <div class="icon purple">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                </div>
                <div class="card-value"><%= stats.monthPasses || 0 %></div>
                <div class="card-label">Passes this month</div>
            </div>
        </div>
        
        <!-- Active Pass (if any) -->
        <% if(activePass) { %>
            <div class="content-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; ">
                <div class="section-header" style="border-color: rgba(255,255,255,0.2);">
                    <h2 style="color: #fff;"><i class="fas fa-exclamation-circle"></i> Active Pass</h2>
                    <span class="status-badge" style="background: rgba(255,255,255,0.2); color: #fff;">
                        <%= activePass.passtype %>
                    </span>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <label style="opacity: 0.7; font-size: 12px;">Approval Date</label>
                        <p style="font-size: 16px; font-weight: 500;"><%= activePass.approvaldt || 'N/A' %></p>
                    </div>
                    <div>
                        <label style="opacity: 0.7; font-size: 12px;">Gate Out</label>
                        <p style="font-size: 16px; font-weight: 500;"><%= activePass.outdatetime || 'Not yet' %></p>
                    </div>
                    <div>
                        <label style="opacity: 0.7; font-size: 12px;">Hostel In</label>
                        <p style="font-size: 16px; font-weight: 500;"><%= activePass.hostelintime || 'Pending' %></p>
                    </div>
                    <div>
                        <label style="opacity: 0.7; font-size: 12px;">Approved By</label>
                        <p style="font-size: 16px; font-weight: 500;"><%= activePass.hosteloutauth || 'N/A' %></p>
                    </div>
                </div>
            </div>
        <% } %>
        
        <!-- Date Filter -->
        <div class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-filter"></i> Filter Passes</h2>
            </div>
            
            <form action="/student/passhistory" method="GET" style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                <div class="form-group" style="margin-bottom: 0;">
                    <label>From Date</label>
                    <input type="date" name="fromDate" value="<%= fromDate || '' %>">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>To Date</label>
                    <input type="date" name="toDate" value="<%= toDate || '' %>">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Pass Type</label>
                    <select name="passType">
                        <option value="">All Types</option>
                        <option value="City Pass" <%= passType === 'City Pass' ? 'selected' : '' %>>City Pass</option>
                        <option value="Home Pass" <%= passType === 'Home Pass' ? 'selected' : '' %>>Home Pass</option>
                    </select>
                </div>
                <button type="submit" class="btn-submit">
                    <i class="fas fa-search"></i> Filter
                </button>
                <a href="/student/passhistory" class="btn-submit" style="background: #888; text-decoration: none;">
                    <i class="fas fa-times"></i> Clear
                </a>
            </form>
        </div>
        
        <!-- Pass History Table -->
        <div class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-list"></i> Pass Records</h2>
            </div>
            
            <% if(passes && passes.length > 0) { %>
                <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Pass Type</th>
                            <th>Approval Date</th>
                            <th>Gate Out</th>
                            <th>Gate In</th>
                            <th>Hostel In</th>
                            <th>Duration</th>
                            <th>Approved By</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% passes.forEach(function(pass, index) { %>
                            <tr>
                                <td><%= index + 1 %></td>
                                <td>
                                    <span class="status-badge <%= pass.passtype === 'City Pass' ? 'pending' : 'active' %>">
                                        <i class="fas <%= pass.passtype === 'City Pass' ? 'fa-city' : 'fa-home' %>"></i>
                                        <%= pass.passtype || 'N/A' %>
                                    </span>
                                </td>
                                <td><%= pass.approvaldt || 'N/A' %></td>
                                <td><%= pass.outdatetime || '-' %></td>
                                <td><%= pass.indatetime || '-' %></td>
                                <td><%= pass.hostelintime || '-' %></td>
                                <td><%= pass.Duration || pass.Durationh || 'N/A' %></td>
                                <td><%= pass.hosteloutauth || 'N/A' %></td>
                                <td>
                                    <% if(pass.status === 'ACTIVE') { %>
                                        <span class="status-badge pending">Active</span>
                                    <% } else if(pass.hostelintime) { %>
                                        <span class="status-badge active">Complete</span>
                                    <% } else if(pass.indatetime) { %>
                                        <span class="status-badge" style="background: rgba(102, 126, 234, 0.15); color: #667eea;">Gate In</span>
                                    <% } else if(pass.outdatetime) { %>
                                        <span class="status-badge pending">Outside</span>
                                    <% } else { %>
                                        <span class="status-badge">Pending</span>
                                    <% } %>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <i class="fas fa-ticket-alt"></i>
                    <h3>No Pass Records</h3>
                    <p>You haven't used any gate passes yet</p>
                    <a href="/student/requestpass" class="btn-submit" style="display: inline-block; margin-top: 15px; text-decoration: none;">
                       <div style="display: flex; justify-content: center; align-items: center; gap: 10px;"> <p>Request a Pass</p></div> 
                    </a>
                </div>
            <% } %>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
            document.querySelector('.sidebar-overlay').classList.toggle('active');
            document.body.style.overflow = document.querySelector('.sidebar').classList.contains('active') ? 'hidden' : '';
        }
    </script>
</body>
</html>
